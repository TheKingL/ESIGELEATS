<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            {% block title %}{% endblock %}
        </title>
        <link rel="stylesheet"
              href="{{ url_for('static', filename='css/output.css') }}">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
              rel="stylesheet" />
        <link rel="stylesheet"
              href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
        <link rel="shortcut icon"
              href="{{ url_for('static', filename='favicon.ico') }}">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    </head>
    <body class="min-h-screen bg-background-light text-ink dark:bg-background-dark dark:text-ink-inverted"
          data-user-authenticated="{{ '1' if session.get('user') else '0' }}"
          data-notifications-url="{% if session.get('user') %}{{ url_for("api.notification_counters") }}{% else %}{% endif %}">
        <div class="flex min-h-screen flex-col">
            {% include 'navbar.html' %}
            <main class="flex-1">
                <div class="container py-6">
                    {% block content %}{% endblock %}
                </div>
            </main>
            <div id="flash-container"
                 class="pointer-events-none fixed bottom-4 right-4 z-50 flex flex-col items-end gap-2">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message toast pointer-events-auto flex w-full max-w-xs justify-center items-center gap-3 rounded-lg border border-primary-100 bg-surface-soft px-4 py-3 text-sm text-ink shadow-lg opacity-0 dark:border-primary-700/60 dark:bg-surface-dark dark:text-ink-inverted">
                                <div class="mt-0.5">
                                    {% if category == 'success' %}
                                        <span class="flex h-7 w-7 items-center justify-center rounded-full bg-emerald-600 text-emerald-50 dark:bg-emerald-900/40 dark:text-emerald-300">
                                            <i class="fa-solid fa-check text-xs"></i>
                                        </span>
                                    {% elif category == 'error' %}
                                        <span class="flex h-7 w-7 items-center justify-center rounded-full bg-rose-600 text-rose-50 dark:bg-rose-900/40 dark:text-rose-300">
                                            <i class="fa-solid fa-xmark text-xs"></i>
                                        </span>
                                    {% else %}
                                        <span class="flex h-7 w-7 items-center justify-center rounded-full bg-amber-600 text-amber-50 dark:bg-amber-900/40 dark:text-amber-300">
                                            <i class="fa-solid fa-info text-xs"></i>
                                        </span>
                                    {% endif %}
                                </div>
                                <div class="flex-1">{{ message }}</div>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        </div>
        <script>
    document.addEventListener('DOMContentLoaded', function () {
      const root = document.documentElement;
      const toggleBtn = document.getElementById('theme-toggle');
      const iconSun = document.getElementById('icon-sun');
      const iconMoon = document.getElementById('icon-moon');
      const logo = document.getElementById('site-logo');

      function updateIcons() {
        const isDark = root.classList.contains('dark');
        if (isDark) {
          if (iconSun) iconSun.style.display = 'none';
          if (iconMoon) iconMoon.style.display = 'inline-block';
        } else {
          if (iconSun) iconSun.style.display = 'inline-block';
          if (iconMoon) iconMoon.style.display = 'none';
        }
      }

      function updateLogo() {
        const isDark = root.classList.contains('dark');
        if (!logo || !logo.dataset) return;
        if (isDark && logo.dataset.darkSrc) logo.src = logo.dataset.darkSrc;
        if (!isDark && logo.dataset.lightSrc) logo.src = logo.dataset.lightSrc;
      }

      function setTheme(isDark) {
        if (isDark) {
          root.classList.add('dark');
          localStorage.theme = 'dark';
        } else {
          root.classList.remove('dark');
          localStorage.theme = 'light';
        }
        updateIcons();
        updateLogo();
      }

      const storedTheme = localStorage.theme;
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initialDark = storedTheme === 'dark' || (!storedTheme && prefersDark);
      setTheme(initialDark);

      if (toggleBtn) {
        toggleBtn.addEventListener('click', function () {
          const isDark = !root.classList.contains('dark');
          setTheme(isDark);
        });
      }
    });
        </script>
        {% if session.get('user') %}<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>{% endif %}
        <script src="{{ url_for('static', filename='js/flash.js') }}" defer></script>
    </body>
</html>
