{% from "components/notifications.html" import notif_pill %}
{% set current_user = session.get("user") %}
{% set current_path = request.path %}
<header class="sticky top-0 z-50 border-b border-primary-100/40 bg-surface-soft/80 backdrop-blur dark:border-primary-700/40 dark:bg-surface-dark/80">
    <div class="container mx-auto relative flex md:grid md:grid-cols-3 items-center justify-between py-3 px-4">
        <!-- LOGO -->
        <a href="{{ url_for('main.home') }}"
           class="flex items-center gap-3 select-none md:justify-self-start">
            <img id="site-logo"
                 src="{{ url_for('static', filename='img/esigeleats_light.png') }}"
                 data-light-src="{{ url_for('static', filename='img/esigeleats_light.png') }}"
                 data-dark-src="{{ url_for('static', filename='img/esigeleats_dark.png') }}"
                 class="h-10 w-10 rounded-full"
                 alt="LOGO ESIGELEATS" />
            <span class="text-xl font-display font-semibold text-primary-700 dark:text-primary-100">ESIGELEATS</span>
        </a>
        <nav class="hidden md:flex items-center gap-6 md:justify-self-center">
            <!-- Nav Item -->
            <a href="{{ url_for('main.home') }}"
               class="relative font-bold text-base text-ink-soft dark:text-ink-lighter hover:text-primary-700 dark:hover:text-primary-100 transition after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:bg-primary-500 dark:after:bg-primary-200 after:rounded-full after:w-0 hover:after:w-full after:transition-all after:duration-300 {% if current_path == '/' %}after:w-full text-primary-700 dark:text-primary-100{% endif %}">
                Accueil
            </a>
            <a href="{{ url_for('recipes.list_recipes') }}"
               class="relative font-bold text-base text-ink-soft dark:text-ink-lighter hover:text-primary-700 dark:hover:text-primary-100 transition after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:bg-primary-500 dark:after:bg-primary-200 after:rounded-full after:w-0 hover:after:w-full after:transition-all after:duration-300 {% if '/recipes/' in current_path %}after:w-full text-primary-700 dark:text-primary-100{% endif %}">
                Recettes
            </a>
            {% if current_user %}
                <a href="{{ url_for('users.user_profile', user_id=current_user.id) }}"
                   class="relative inline-flex items-center gap-1 font-bold text-base text-ink-soft dark:text-ink-lighter hover:text-primary-700 dark:hover:text-primary-100 transition after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:bg-primary-500 dark:after:bg-primary-200 after:rounded-full after:w-0 hover:after:w-full after:transition-all after:duration-300 {% if '/users/' in current_path %}after:w-full text-primary-700 dark:text-primary-100{% endif %}">
                    <span>Profil</span>
                    {{ notif_pill("changes-required",
                                        navbar_changes_required_count if navbar_changes_required_count is defined else 0,
                                        "absolute -top-1 -right-3") }}
                </a>
            {% endif %}
            {% if current_user and current_user.is_admin %}
                <a href="{{ url_for('admin.dashboard') }}"
                   class="relative inline-flex items-center font-bold text-base text-red-600 dark:text-red-300 hover:text-red-700 dark:hover:text-red-200 transition after:absolute after:left-0 after:-bottom-1 after:h-[2px] after:bg-red-500 dark:after:bg-red-200 after:rounded-full after:w-0 hover:after:w-full after:transition-all after:duration-300 {% if '/admin/' in current_path %}after:w-full text-red-700 dark:text-red-100{% endif %}">
                    <span>Admin</span>
                    {{ notif_pill("admin-pending",
                                        navbar_pending_recipes_count if navbar_pending_recipes_count is defined else 0,
                                        "absolute -top-1 -right-3") }}
                </a>
            {% endif %}
        </nav>
        <!-- ACTIONS -->
        <div class="flex items-center gap-3 md:justify-self-end">
            {% if current_user %}
                <!-- LOGOUT -->
                <a href="{{ url_for('auth.logout') }}"
                   class="hidden px-3 py-2 md:inline-block h-10 w-10 rounded-full bg-rose-200 text-rose-700 hover:bg-rose-300 hover:text-rose-800 dark:bg-rose-900/40 dark:text-rose-300 dark:hover:bg-rose-700/40 dark:hover:text-rose-200">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </a>
            {% else %}
                <a href="{{ url_for('auth.login') }}"
                   class="hidden md:inline-block px-4 py-1.5 rounded-xl text-sm font-semibold bg-primary-500 text-white hover:bg-primary-600">
                    Connexion
                </a>
                <a href="{{ url_for('auth.register') }}"
                   class="hidden md:inline-block px-4 py-1.5 rounded-xl text-sm font-semibold border border-primary-200 bg-surface-light text-primary-700 hover:bg-primary-50 dark:border-primary-700 dark:bg-surface-dark dark:text-primary-200">
                    Inscription
                </a>
            {% endif %}
            <!-- THEME BUTTON (ALWAYS VISIBLE) -->
            <button id="theme-toggle"
                    class="h-10 w-10 flex items-center justify-center rounded-full bg-surface-light dark:bg-surface-dark border border-primary-100/40 dark:border-primary-700/40 text-primary-700 dark:text-primary-100 hover:bg-primary-50 dark:hover:bg-primary-700/30">
                <span id="icon-sun" class="material-symbols-outlined">light_mode</span>
                <span id="icon-moon" class="material-symbols-outlined">dark_mode</span>
            </button>
            <!-- BURGER -->
            <button id="menu-toggle"
                    class="md:hidden h-10 w-10 flex items-center justify-center rounded-lg bg-surface-light dark:bg-surface-dark border border-primary-100/40 dark:border-primary-700/40 hover:bg-primary-50 dark:hover:bg-primary-700/30">
                <i class="fa-solid fa-bars text-xl text-primary-700 dark:text-primary-100"></i>
            </button>
        </div>
    </div>
    <!-- MENU MOBILE -->
    <div id="mobile-menu"
         class="md:hidden max-h-0 overflow-hidden transition-all duration-300 bg-surface-light dark:bg-surface-dark border-t border-primary-100/40 dark:border-primary-700/40">
        <nav class="flex flex-col px-4 py-4 text-base font-semibold">
            <a href="{{ url_for('main.home') }}"
               class="py-2 text-ink dark:text-ink-inverted hover:text-primary-600 dark:hover:text-primary-300">Accueil</a>
            <a href="{{ url_for('recipes.list_recipes') }}"
               class="py-2 text-ink dark:text-ink-inverted hover:text-primary-600 dark:hover:text-primary-300">Recettes</a>
            {% if current_user %}
                <a href="{{ url_for('users.user_profile', user_id=current_user.id) }}"
                   class="py-2 text-ink dark:text-ink-inverted hover:text-primary-600 dark:hover:text-primary-300">
                    Profil
                </a>
                {% if current_user.is_admin %}
                    <a href="{{ url_for('main.home') }}"
                       class="py-2 text-red-600 hover:text-red-800 dark:text-red-300 dark:hover:text-red-200">Admin</a>
                {% endif %}
                <a href="{{ url_for('auth.logout') }}"
                   class="py-2 text-rose-600 hover:text-rose-800 dark:text-rose-300 dark:hover:text-rose-200">
                    DÃ©connexion
                </a>
            {% else %}
                <a href="{{ url_for('auth.login') }}" class="py-2">Connexion</a>
                <a href="{{ url_for('auth.register') }}" class="py-2">Inscription</a>
            {% endif %}
        </nav>
    </div>
</header>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("menu-toggle");
    const menu = document.getElementById("mobile-menu");
    const icon = btn.querySelector("i");

    btn.addEventListener("click", () => {
        const open = menu.classList.contains("max-h-0");

        if (open) {
            menu.classList.remove("max-h-0");
            menu.classList.add("max-h-96");
            icon.classList.replace("fa-bars", "fa-xmark");
        } else {
            menu.classList.add("max-h-0");
            menu.classList.remove("max-h-96");
            icon.classList.replace("fa-xmark", "fa-bars");
        }
    });
});
</script>
